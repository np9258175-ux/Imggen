<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Magic Hour - Text to Image</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; text-align: center; background: #f4f4f9; }
    h1 { color: #333; }
    textarea { width: 80%; max-width: 500px; height: 80px; padding: 10px; font-size: 16px; }
    button { margin-top: 10px; padding: 10px 20px; font-size: 16px; cursor: pointer; }
    #result { margin-top: 20px; }
    #log { margin-top: 10px; background: #fff; padding: 10px; border: 1px solid #ccc; text-align: left; max-width: 90%; margin-left:auto; margin-right:auto; white-space: pre-wrap; font-family: monospace; }
    img { max-width: 90%; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.2); }
  </style>
</head>
<body>
  <h1>Magic Hour - Text to Image</h1>
  <p>Enter a prompt and click Generate</p>
  <textarea id="prompt" placeholder="e.g. A futuristic city at sunset with flying cars"></textarea><br>
  <button onclick="generateImage()">Generate</button>
  <div id="result"></div>
  <div id="log"></div>

  <script>
    // Use your fake key for testing, replace with real key for actual image generation
    const API_KEY = "mhk_live_BgcvT6syOzTtmUIr2mUy8fjQ8nNGwCcTqqWNhfqEGHHKQ37uZLaLFM5V6dQ5aBtEU42OdSE3Pfv9Bj5L";

    async function generateImage() {
      const prompt = document.getElementById("prompt").value.trim();
      const resultDiv = document.getElementById("result");
      const logDiv = document.getElementById("log");
      logDiv.innerText = "";
      if (!prompt) {
        alert("Please enter a prompt!");
        return;
      }

      resultDiv.innerHTML = "⏳ Sending request...";
      logDiv.innerText += "Sending request to Magic Hour API...\n";

      try {
        const resp = await fetch("https://api.magichour.ai/v1/ai-image-generator", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${API_KEY}`
          },
          body: JSON.stringify({
            image_count: 1,
            orientation: "square",
            style: { prompt: prompt },
            name: "html-test",
            wait_for_completion: false
          })
        });

        const data = await resp.json();
        logDiv.innerText += "Initial response:\n" + JSON.stringify(data, null, 2) + "\n";

        if (!data.id) {
          resultDiv.innerHTML = "❌ Failed to get generation ID. Check log.";
          return;
        }

        const genId = data.id;
        resultDiv.innerHTML = "⏳ Generation started, waiting for image...";

        const interval = setInterval(async () => {
          const statusResp = await fetch(`https://api.magichour.ai/v1/ai-image-generator/${genId}`, {
            headers: { "Authorization": `Bearer ${API_KEY}` }
          });
          const statusData = await statusResp.json();
          logDiv.innerText += "Polling response:\n" + JSON.stringify(statusData, null, 2) + "\n";

          if (statusData.outputs && statusData.outputs.length > 0 && statusData.outputs[0].url) {
            clearInterval(interval);
            const imageUrl = statusData.outputs[0].url;
            resultDiv.innerHTML = `<img src="${imageUrl}" alt="Generated Image">`;
            logDiv.innerText += "✅ Image ready and displayed.\n";
          } else if (statusData.status === "failed") {
            clearInterval(interval);
            resultDiv.innerHTML = "❌ Image generation failed.";
            logDiv.innerText += "⚠️ Generation failed.\n";
          } else {
            resultDiv.innerHTML = "⏳ Generating image... please wait.";
          }
        }, 2000);

      } catch (err) {
        resultDiv.innerHTML = "⚠️ Error occurred!";
        logDiv.innerText += "Error: " + err.message + "\n";
      }
    }
  </script>
</body>
</html>
