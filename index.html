<!DOCTYPE html>
<html>
<head>
  <title>Magic Hour Image Generator</title>
</head>
<body>
  <h1>Magic Hour Image Generator</h1>

  <textarea id="prompt" rows="4" cols="50" placeholder="Enter prompt"></textarea><br>
  <button onclick="generateImage()">Generate Image</button>

  <h2>Result:</h2>
  <div id="image-container">No image yet</div>

  <h2>Logs:</h2>
  <pre id="log"></pre>

  <script>
    const API_KEY = "mhk_live_BgcvT6syOzTtmUIr2mUy8fjQ8nNGwCcTqqWNhfqEGHHKQ37uZLaLFM5V6dQ5aBtEU42OdSE3Pfv9Bj5L";
    const resultDiv = document.getElementById("image-container");
    const logDiv = document.getElementById("log");

    async function generateImage() {
      const prompt = document.getElementById("prompt").value.trim();
      if (!prompt) return alert("Enter prompt");

      resultDiv.innerText = "⏳ Sending request...";
      logDiv.innerText = "";

      try {
        // Send prompt to Magic Hour API
        const resp = await fetch("https://api.magichour.ai/v1/ai-image-generator", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${API_KEY}`
          },
          body: JSON.stringify({
            image_count: 1,
            orientation: "square",
            style: { prompt: prompt },
            name: prompt,
            wait_for_completion: false
          })
        });

        const data = await resp.json();
        logDiv.innerText += "Initial response:\n" + JSON.stringify(data, null, 2) + "\n";

        if (!data.id) {
          resultDiv.innerText = "❌ No generation ID";
          return;
        }

        const genId = data.id;
        resultDiv.innerText = "⏳ Generating image... please wait.";

        // Poll API for image status
        const interval = setInterval(async () => {
          const statusResp = await fetch(`https://api.magichour.ai/v1/ai-image-generator/${genId}`, {
            headers: { "Authorization": `Bearer ${API_KEY}` }
          });
          const statusData = await statusResp.json();
          logDiv.innerText += JSON.stringify(statusData, null, 2) + "\n";

          if (statusData.outputs && statusData.outputs[0]?.url) {
            clearInterval(interval);
            const url = statusData.outputs[0].url;
            resultDiv.innerHTML = `<img src="${url}" width="400" alt="Generated Image">`;
            logDiv.innerText += "✅ Image ready\n";
          } else if (statusData.status === "failed") {
            clearInterval(interval);
            resultDiv.innerText = "❌ Image generation failed";
          } else {
            resultDiv.innerText = "⏳ Generating image... please wait.";
          }
        }, 2000);

      } catch (err) {
        resultDiv.innerText = "⚠️ Error occurred!";
        logDiv.innerText += "Error: " + err.message + "\n";
      }
    }
  </script>
</body>
</html>          },
          body: JSON.stringify({
            image_count: 1,
            orientation: "square",
            style: { prompt: prompt },
            name: prompt,
            wait_for_completion: false
          })
        });

        const data = await resp.json();
        logDiv.innerText += "Initial response:\n" + JSON.stringify(data, null, 2) + "\n";

        if (!data.id) {
          resultDiv.innerText = "❌ No generation ID";
          return;
        }

        const genId = data.id;
        resultDiv.innerText = "⏳ Generating image... please wait.";

        // Poll Magic Hour API for image status
        const interval = setInterval(async () => {
          const statusResp = await fetch(`https://api.magichour.ai/v1/ai-image-generator/${genId}`, {
            headers: { "Authorization": `Bearer ${API_KEY}` }
          });
          const statusData = await statusResp.json();
          logDiv.innerText += JSON.stringify(statusData, null, 2) + "\n";

          if (statusData.outputs && statusData.outputs[0]?.url) {
            clearInterval(interval);
            const url = statusData.outputs[0].url;
            resultDiv.innerHTML = `<img src="${url}" width="400" alt="Generated Image">`;
            logDiv.innerText += "✅ Image ready\n";
          } else if (statusData.status === "failed") {
            clearInterval(interval);
            resultDiv.innerText = "❌ Image generation failed";
          } else {
            resultDiv.innerText = "⏳ Generating image... please wait.";
          }
        }, 2000);

      } catch (err) {
        resultDiv.innerText = "⚠️ Error occurred!";
        logDiv.innerText += "Error: " + err.message + "\n";
      }
    }
  </script>
</body>
</html>            clearInterval(interval);
          }
        }, 2000);

      } catch (err) {
        resultDiv.innerText = "⚠️ Error occurred!";
        logDiv.innerText += "Error: " + err.message + "\n";
      }
    }
  </script>
</body>
</html>          body: JSON.stringify({
            image_count: 1,
            orientation: "square",
            style: { prompt: prompt },
            name: "minimal-test",
            wait_for_completion: false
          })
        });

        const data = await resp.json();
        logDiv.innerText += "Initial response:\n" + JSON.stringify(data, null, 2) + "\n";

        if (!data.id) {
          resultDiv.innerText = "❌ No generation ID";
          return;
        }

        const genId = data.id;
        resultDiv.innerText = "⏳ Generating image... please wait.";

        const interval = setInterval(async () => {
          const statusResp = await fetch(`https://api.magichour.ai/v1/ai-image-generator/${genId}`, {
            headers: { "Authorization": `Bearer ${API_KEY}` }
          });
          const statusData = await statusResp.json();
          logDiv.innerText += JSON.stringify(statusData, null, 2) + "\n";

          if (statusData.outputs && statusData.outputs[0]?.url) {
            clearInterval(interval);
            const url = statusData.outputs[0].url;
            resultDiv.innerHTML = `<img src="${url}" width="400" alt="Generated Image">`;
            logDiv.innerText += "✅ Image ready\n";
          } else if (statusData.status === "failed") {
            clearInterval(interval);
            resultDiv.innerText = "❌ Image generation failed";
          } else {
            resultDiv.innerText = "⏳ Generating image... please wait.";
          }
        }, 2000);

      } catch (err) {
        resultDiv.innerText = "⚠️ Error occurred!";
        logDiv.innerText += "Error: " + err.message + "\n";
      }
    }

    // Poll webhook latest image (optional if using webhook)
    async function fetchLatestImage() {
      try {
        const resp = await fetch("/api/latest-image");
        const data = await resp.json();
        if (data.url) {
          resultDiv.innerHTML = `<img src="${data.url}" width="400" alt="Generated Image">`;
        }
      } catch (err) {
        console.error(err);
      }
    }

    setInterval(fetchLatestImage, 2000);
    fetchLatestImage();
  </script>
</body>
</html>
