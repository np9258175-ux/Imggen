<!DOCTYPE html>
<html>
<head>
  <title>Magic Hour Webhook Test</title>
</head>
<body>
  <h1>Generated Image from Webhook</h1>
  <div id="image-container">No image yet</div>

  <script>
    const container = document.getElementById("image-container");

    async function fetchLatestImage() {
      try {
        const resp = await fetch("/api/latest-image");
        const data = await resp.json();
        if (data.url) {
          container.innerHTML = `<img src="${data.url}" width="400" alt="Generated Image">`;
        } else {
          container.innerText = "No image yet";
        }
      } catch (err) {
        container.innerText = "Error fetching image";
        console.error(err);
      }
    }

    // Poll every 2 seconds
    setInterval(fetchLatestImage, 2000);
    fetchLatestImage(); // fetch immediately on page load
  </script>
</body>
</html>            style: { prompt: prompt },
            name: "minimal-test",
            wait_for_completion: false
          })
        });

        const data = await resp.json();
        logDiv.innerText += "Initial response:\n" + JSON.stringify(data, null, 2) + "\n";

        if (!data.id) { 
          resultDiv.innerHTML = "❌ No generation ID"; 
          return; 
        }

        const genId = data.id;
        resultDiv.innerHTML = "⏳ Generating image... please wait.";

        const interval = setInterval(async () => {
          const statusResp = await fetch(`https://api.magichour.ai/v1/ai-image-generator/${genId}`, {
            headers: { "Authorization": `Bearer ${API_KEY}` }
          });
          const statusData = await statusResp.json();
          logDiv.innerText += JSON.stringify(statusData, null, 2) + "\n";

          if (statusData.outputs && statusData.outputs[0]?.url) {
            clearInterval(interval);
            const url = statusData.outputs[0].url;
            resultDiv.innerHTML = `<img src="${url}" alt="Generated Image" width="400">`;
            logDiv.innerText += "✅ Image ready\n";
          } else if (statusData.status === "failed") {
            clearInterval(interval);
            resultDiv.innerHTML = "❌ Image generation failed";
          } else {
            resultDiv.innerHTML = "⏳ Generating image... please wait.";
          }
        }, 2000);

      } catch (err) {
        resultDiv.innerHTML = "⚠️ Error occurred!";
        logDiv.innerText += "Error: " + err.message + "\n";
      }
    }
  </script>
</body>
</html>
